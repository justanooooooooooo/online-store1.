<!--
Justan Online Store (single file)
Features:
- Product list with Add to Cart
- Cart sidebar with quantity controls and remove
- Checkout by Email: opens user's email client (mailto:) with order summary prefilled

How to use:
1. Save this file as `store.html` and open it in a browser.
2. Add items to cart, click Checkout, fill buyer info, and the email client will open with the order.

Notes / Limitations:
- mailto: approach depends on user's local email client or webmail handler; it does NOT send email automatically.
- To send programmatically (no user email client), you'll need a backend or a third-party service (EmailJS, SendGrid, etc.). I can add EmailJS integration if you want.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Justan Online Store</title>
  <style>
    :root{--accent:#2563eb;--bg:#f8fafc;--card:#ffffff;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    header{background:linear-gradient(90deg,var(--accent),#7c3aed);color:#fff;padding:18px 24px}
    header h1{margin:0;font-size:20px}
    .container{max-width:1100px;margin:20px auto;padding:0 16px;display:grid;grid-template-columns:1fr 340px;gap:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    .product img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .product h3{margin:8px 0 6px;font-size:16px}
    .price{font-weight:700;margin-right:8px}
    .muted{color:var(--muted);font-size:13px}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
    .cart{position:sticky;top:20px}
    .cart h2{margin:0 0 8px}
    .cart-items{max-height:360px;overflow:auto;margin-bottom:12px}
    .cart-row{display:flex;gap:8px;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
    .qty{display:flex;align-items:center;gap:6px}
    input[type="number"]{width:64px;padding:6px;border-radius:6px;border:1px solid #e5e7eb}
    label{display:block;margin:6px 0 3px;font-size:13px}
    .checkout-form input,.checkout-form textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf3}
    .totals{display:flex;justify-content:space-between;margin:8px 0 14px}
    footer{padding:20px;text-align:center;color:var(--muted)}
    @media (max-width:900px){.container{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container" style="max-width:1200px;display:flex;align-items:center;justify-content:space-between">
      <h1>Justan Online Store</h1>
      <div class="muted">No backend required — opens your email client</div>
    </div>
  </header>

  <main class="container">
    <section>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <h2 style="margin:0">Products</h2>
        <div class="muted">Select items and click "Add to Cart"</div>
      </div>

      <div class="products" id="productList"></div>
    </section>

    <aside class="cart card" aria-labelledby="cartHeading">
      <h2 id="cartHeading">Your Cart</h2>
      <div class="cart-items" id="cartItems">
        <div class="muted">Cart is empty</div>
      </div>

      <div class="totals">
        <div class="muted">Subtotal</div>
        <div id="subtotal">$0.00</div>
      </div>

      <details open>
        <summary style="cursor:pointer;margin-bottom:8px">Checkout details</summary>
        <form class="checkout-form" id="checkoutForm" onsubmit="return false;">
          <label for="buyerName">Full name</label>
          <input id="buyerName" placeholder="Jane Doe" required />

          <label for="buyerEmail">Your email</label>
          <input id="buyerEmail" type="email" placeholder="name@example.com" required />

          <label for="buyerAddress">Shipping address</label>
          <textarea id="buyerAddress" rows="2" placeholder="Street, City, ZIP"></textarea>

          <label for="notes">Notes (optional)</label>
          <textarea id="notes" rows="2" placeholder="Gift wrap, delivery notes..."></textarea>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="checkoutBtn">Checkout by Email</button>
            <button class="ghost" id="copyBtn" type="button">Copy order text</button>
          </div>
        </form>
      </details>

      <div style="margin-top:12px;font-size:13px;color:var(--muted)">Note: Clicking "Checkout by Email" will open your email app with a pre-filled message. The email won't be sent until you press send in your email client.</div>
    </aside>
  </main>

  <footer>
    Built with ❤️ — Save this file and open it in a browser to test.
  </footer>

  <script>
    // Sample products — edit or extend
    const products = [
      { id: 'p1', title: '麥香紅茶', price: 15 , img: '7882879_O_m.jpg' },
      { id: 'p2', title: '麥香綠茶', price: 15 , img: 'https://web.hocom.tw/Uploads/Product/s/25003/148630_374577231671.jpg' },
      { id: 'p3', title: '麥香奶茶', price: 15 , img: 'https://web.hocom.tw/Uploads/Product/s/25003/148632_742701449649.jpg' },
      { id: 'p4', title: 'Canvas Tote Bag', price: 14.25, img: 'https://images.unsplash.com/photo-1556909210-5f2f0c13ba0c?auto=format&fit=crop&w=800&q=60' }
    ];

    // In-memory cart
    const cart = {};

    function formatMoney(n){return '$' + n.toFixed(2)}

    function renderProducts(){
      const container = document.getElementById('productList');
      container.innerHTML = '';
      products.forEach(p=>{
        const el = document.createElement('div'); el.className='card product';
        el.innerHTML = `
          <img src="${p.img}" alt="${p.title}" loading="lazy">
          <h3>${p.title}</h3>
          <div class="muted">Description or short subtitle</div>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
            <div><span class="price">${formatMoney(p.price)}</span><span class="muted">each</span></div>
            <button onclick="addToCart('${p.id}')">Add to Cart</button>
          </div>
        `;
        container.appendChild(el);
      })
    }

    function addToCart(productId){
      const p = products.find(x=>x.id===productId);
      if(!p) return;
      if(!cart[productId]) cart[productId] = {...p, qty:0};
      cart[productId].qty++;
      renderCart();
    }

    function removeFromCart(productId){
      delete cart[productId];
      renderCart();
    }

    function changeQty(productId, val){
      if(!cart[productId]) return;
      cart[productId].qty = Math.max(0, Math.floor(Number(val) || 0));
      if(cart[productId].qty===0) removeFromCart(productId);
      else renderCart();
    }

    function getSubtotal(){
      return Object.values(cart).reduce((s,i)=>s + i.price*i.qty, 0);
    }

    function renderCart(){
      const container = document.getElementById('cartItems');
      container.innerHTML = '';
      const items = Object.values(cart);
      if(items.length===0){ container.innerHTML = '<div class="muted">Cart is empty</div>'; document.getElementById('subtotal').textContent = formatMoney(0); return; }
      items.forEach(item=>{
        const row = document.createElement('div'); row.className='cart-row';
        row.innerHTML = `
          <div style="flex:1">
            <div style="font-weight:600">${item.title}</div>
            <div class="muted">${formatMoney(item.price)} × ${item.qty} = ${formatMoney(item.price*item.qty)}</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end">
            <div class="qty">
              <button onclick="changeQty('${item.id}', ${item.qty - 1})" aria-label="decrease">-</button>
              <input type="number" min="0" value="${item.qty}" onchange="changeQty('${item.id}', this.value)">
              <button onclick="changeQty('${item.id}', ${item.qty + 1})" aria-label="increase">+</button>
            </div>
            <div style="margin-top:6px"><button class="ghost" onclick="removeFromCart('${item.id}')">Remove</button></div>
          </div>
        `;
        container.appendChild(row);
      })
      document.getElementById('subtotal').textContent = formatMoney(getSubtotal());
    }

    // Build the mailto: URL with order details
    function buildOrderText(){
      const name = document.getElementById('buyerName').value.trim();
      const email = document.getElementById('buyerEmail').value.trim();
      const address = document.getElementById('buyerAddress').value.trim();
      const notes = document.getElementById('notes').value.trim();

      const items = Object.values(cart);
      if(items.length===0) return {ok:false,message:'Cart is empty'};
      if(!name || !email) return {ok:false,message:'Please enter name and email in the checkout form.'};

      let body = `Order from ${name}%0D%0A`;
      body += `Contact email: ${email}%0D%0A`;
      if(address) body += `Shipping address: ${address}%0D%0A`;
      body += '%0D%0AItems:%0D%0A';
      items.forEach(it=>{
        body += `- ${it.title}  x ${it.qty}  @ ${formatMoney(it.price)} = ${formatMoney(it.price*it.qty)}%0D%0A`;
      });
      body += '%0D%0A';
      body += `Subtotal: ${formatMoney(getSubtotal())}%0D%0A`;
      const shipping = 0; // adjust if you want flat shipping
      body += `Shipping: ${formatMoney(shipping)}%0D%0A`;
      const total = getSubtotal() + shipping;
      body += `Total: ${formatMoney(total)}%0D%0A`;
      if(notes) body += `%0D%0ANotes: ${notes}%0D%0A`;

      return {ok:true,subject:`Order from ${name}`,body};
    }

    document.getElementById('checkoutBtn').addEventListener('click', ()=>{
      const order = buildOrderText();
      if(!order.ok){ alert(order.message); return; }

      // Use mailto: — replace shop@example.com with your receiving address
      const to = 'justanchen2010@gmail.com';
      const mailto = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent(order.subject)}&body=${order.body}`;

      // Open user's email client
      window.location.href = mailto;
    });

    // Copy order text to clipboard for manual paste
    document.getElementById('copyBtn').addEventListener('click', async ()=>{
      const order = buildOrderText();
      if(!order.ok){ alert(order.message); return; }
      // decode %0D%0A -> newlines
      const decoded = decodeURIComponent(order.body);
      try{
        await navigator.clipboard.writeText(`${order.subject}\n\n${decoded}`);
        alert('Order text copied to clipboard — paste into your email or send it to the shop.');
      }catch(e){
        prompt('Copy the order text below:', `${order.subject}\n\n${decoded}`);
      }
    });

    // Initial render
    renderProducts();
    renderCart();
  </script>
</body>
</html>
